services:
  # Backend API (Go)
  - type: web
    name: poppo-backend
    env: go
    region: oregon
    plan: free
    buildCommand: go mod download && go build -o bin/server .
    startCommand: ./bin/server
    envVars:
      - key: SUPABASE_JWT_SECRET
        sync: false
      - key: OPENAI_API_KEY
        sync: false
        optional: true
      - key: PORT
        value: "8080"
      - key: CORS_ORIGINS
        sync: false
        # Set this to your frontend URL after deployment
        # Example: https://poppo-frontend.onrender.com
    # Note: Disk removed for free plan (no credit card required)
    # Data will be stored in ephemeral storage (may be lost on restart)
    # For persistent storage, upgrade to paid plan or use external storage (S3, etc.)
    # Health check endpoint (optional)
    healthCheckPath: /api/me

  # Frontend (React)
  - type: web
    name: poppo-frontend
    env: node
    region: oregon
    plan: free
    buildCommand: cd frontend && npm install && npm run build
    startCommand: cd frontend && npx serve -s dist -l $PORT
    envVars:
      - key: VITE_SUPABASE_URL
        sync: false
        # Required: Set your Supabase project URL
      - key: VITE_SUPABASE_ANON_KEY
        sync: false
        # Required: Set your Supabase anon key
      - key: VITE_API_BASE
        sync: false
        # Optional: Set this to your backend URL after deployment
        # Example: https://poppo-backend.onrender.com/api
        # If not set, defaults to http://localhost:8080/api
      - key: PORT
        value: "3000"
    # Note: routes are only supported for static sites, not web services
    # The serve command with -s flag handles SPA routing automatically

