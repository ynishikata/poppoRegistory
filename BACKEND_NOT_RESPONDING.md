# バックエンドが応答しない場合の対処法

## 症状

- アプリが動かない
- ログが表示されない
- フロントエンドからバックエンドに接続できない

## 確認手順

### 1. バックエンドサービスのステータス確認

Render Dashboardで：
1. バックエンドサービス（`poppo-backend`）を選択
2. ステータスを確認：
   - **"Live"**: 起動中（正常）
   - **"Sleeping"**: スリープ中（無料プラン）
   - **"Building"**: ビルド中
   - **"Deploying"**: デプロイ中
   - **"Failed"**: エラー

### 2. バックエンドがスリープしている場合

無料プランでは15分間非アクティブでスリープします。

**対処法:**
1. バックエンドのURLに直接アクセス: `https://poppo-backend.onrender.com/api/me`
2. 30秒〜1分待つ（起動に時間がかかる）
3. 再度アクセスして、起動を確認
4. 起動後、フロントエンドから再度試す

### 3. ログが表示されない場合

**確認方法:**
1. Render Dashboardでバックエンドサービスを選択
2. "Logs" タブを開く
3. ログが表示されているか確認
4. ログが表示されない場合は、サービスが起動していない可能性

### 4. バックエンドが起動しない場合

**確認事項:**
1. 環境変数が正しく設定されているか
   - `SUPABASE_JWT_SECRET`: 必須
   - `PORT`: デフォルト8080
2. ビルドエラーがないか
   - "Events" タブでビルド履歴を確認
3. 起動エラーがないか
   - "Logs" タブでエラーメッセージを確認

### 5. 手動で再デプロイ

1. Render Dashboardでバックエンドサービスを選択
2. "Manual Deploy" → "Deploy latest commit" をクリック
3. ビルドとデプロイが開始される
4. ログを確認してエラーがないか確認

## よくある問題と解決方法

### 問題1: バックエンドがスリープしている

**症状:**
- フロントエンドから接続できない
- タイムアウトエラー

**解決方法:**
- バックエンドのURLに直接アクセスして起動
- または、有料プランにアップグレード（スリープなし）

### 問題2: 環境変数が設定されていない

**症状:**
- バックエンドが起動しない
- ログに "SUPABASE_JWT_SECRET not configured" と表示

**解決方法:**
1. Render Dashboardでバックエンドサービスを選択
2. "Environment" タブを開く
3. `SUPABASE_JWT_SECRET` を設定
4. サービスを再デプロイ

### 問題3: ビルドエラー

**症状:**
- デプロイが失敗する
- "Build failed" と表示

**解決方法:**
1. "Logs" タブでビルドエラーを確認
2. エラー内容に応じて修正
3. 再デプロイ

## デバッグ手順

### ステップ1: バックエンドのURLに直接アクセス

ブラウザで以下にアクセス:
```
https://poppo-backend.onrender.com/api/me
```

- **401 Unauthorized**: バックエンドは起動している（認証が必要なエンドポイント）
- **接続エラー**: バックエンドが起動していない、またはスリープ中

### ステップ2: ログを確認

Render Dashboardで：
1. バックエンドサービス → "Logs" タブ
2. 最新のログを確認
3. エラーメッセージがないか確認

### ステップ3: 環境変数を確認

Render Dashboardで：
1. バックエンドサービス → "Environment" タブ
2. 必須の環境変数が設定されているか確認：
   - `SUPABASE_JWT_SECRET`
   - `PORT` (オプション、デフォルト8080)

## 緊急時の対処

### バックエンドを強制的に再起動

1. Render Dashboardでバックエンドサービスを選択
2. "Settings" タブを開く
3. "Restart" ボタンをクリック（または "Manual Deploy" → "Deploy latest commit"）

### フロントエンドの環境変数を確認

1. フロントエンドサービス → "Environment" タブ
2. `VITE_API_BASE` が正しく設定されているか確認
3. バックエンドのURLと一致しているか確認

## 次のステップ

1. バックエンドのURLに直接アクセスして起動を確認
2. Render Dashboardのログを確認
3. 環境変数が正しく設定されているか確認
4. 問題が解決しない場合は、ログの内容を共有してください

