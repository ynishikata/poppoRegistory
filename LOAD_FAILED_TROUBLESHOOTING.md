# 一覧読み込み失敗（load failed）のトラブルシューティング

## よくある原因と解決方法

### 1. API_BASEが設定されていない

**症状:**
- 一覧が読み込めない
- ブラウザのコンソールに「APIサーバーに接続できません」というエラー

**解決方法:**
1. Render Dashboardでフロントエンドサービスを選択
2. "Environment" タブを開く
3. `VITE_API_BASE` 環境変数を確認
4. バックエンドのURLを設定（例: `https://poppo-backend.onrender.com/api`）
5. サービスを再デプロイ

### 2. CORS設定の問題

**症状:**
- ブラウザのコンソールにCORSエラーが表示される
- "Access-Control-Allow-Origin" エラー

**解決方法:**
1. Render Dashboardでバックエンドサービスを選択
2. "Environment" タブを開く
3. `CORS_ORIGINS` 環境変数を確認
4. フロントエンドのURLを設定（例: `https://poppo-frontend.onrender.com`）
5. バックエンドサービスを再デプロイ

### 3. 認証トークンの問題

**症状:**
- "認証が必要です。ログインしてください。" というエラー
- ログインしているのにエラーが出る

**解決方法:**
1. 一度ログアウトして、再度ログイン
2. ブラウザの開発者ツール（F12）でApplicationタブを確認
3. Local StorageにSupabaseのセッションが保存されているか確認

### 4. バックエンドがスリープしている

**症状:**
- 初回アクセス時にタイムアウト
- 無料プランで15分間非アクティブでスリープ

**解決方法:**
1. バックエンドのURLに直接アクセスして起動を待つ
2. 30秒〜1分待ってから再度試す
3. または、有料プランにアップグレード（スリープなし）

### 5. バックエンドが起動していない

**症状:**
- バックエンドのURLにアクセスできない
- 404エラーまたは接続エラー

**解決方法:**
1. Render Dashboardでバックエンドサービスのステータスを確認
2. "Live" と表示されているか確認
3. "Logs" タブでエラーがないか確認
4. エラーがある場合は修正して再デプロイ

## 確認手順

### ステップ1: ブラウザの開発者ツールで確認

1. ブラウザでF12キーを押して開発者ツールを開く
2. "Console" タブでエラーメッセージを確認
3. "Network" タブでAPIリクエストを確認
   - `/api/plushies` リクエストのステータスコードを確認
   - エラーの場合は赤色で表示される

### ステップ2: 環境変数を確認

**フロントエンド:**
- `VITE_API_BASE`: バックエンドのURL（例: `https://poppo-backend.onrender.com/api`）
- `VITE_SUPABASE_URL`: SupabaseプロジェクトのURL
- `VITE_SUPABASE_ANON_KEY`: Supabase Anon Key

**バックエンド:**
- `SUPABASE_JWT_SECRET`: Supabase JWT Secret
- `CORS_ORIGINS`: フロントエンドのURL（例: `https://poppo-frontend.onrender.com`）

### ステップ3: APIエンドポイントを直接テスト

ブラウザで以下のURLにアクセス（認証が必要な場合はエラーが返る）:
```
https://poppo-backend.onrender.com/api/plushies
```

- 認証エラーが返る場合は、バックエンドは動作している
- 接続エラーの場合は、バックエンドが起動していないか、URLが間違っている

## デバッグ方法

### フロントエンドでAPI_BASEを確認

ブラウザのコンソールで以下を実行:
```javascript
console.log(import.meta.env.VITE_API_BASE);
```

開発環境では、コンソールに `API_BASE` と `API_ORIGIN` が表示されます。

### ネットワークタブでリクエストを確認

1. 開発者ツールの "Network" タブを開く
2. ページをリロード
3. `/api/plushies` リクエストを確認
4. リクエストの詳細を確認:
   - URL: 正しいバックエンドURLになっているか
   - ステータスコード: 200, 401, 404, 500など
   - レスポンス: エラーメッセージの内容

## よくあるエラーメッセージ

### "APIサーバーに接続できません"
- `VITE_API_BASE` が設定されていない
- バックエンドのURLが間違っている
- バックエンドが起動していない

### "認証が必要です。ログインしてください。"
- ログインしていない
- 認証トークンが無効
- Supabaseのセッションが切れている

### "CORS policy"
- `CORS_ORIGINS` にフロントエンドのURLが設定されていない
- バックエンドのCORS設定が間違っている

## 解決後の確認

1. ブラウザでフロントエンドのURLにアクセス
2. ログイン
3. 一覧が表示されることを確認
4. ブラウザのコンソールにエラーがないことを確認

